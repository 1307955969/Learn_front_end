require=function t(e,o,n){function i(s,r){if(!o[s]){if(!e[s]){var a="function"==typeof require&&require;if(!r&&a)return a(s,!0);if(c)return c(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var l=o[s]={exports:{}};e[s][0].call(l.exports,function(t){var o=e[s][1][t];return i(o?o:t)},l,l.exports,t,e,o,n)}return o[s].exports}for(var c="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}({game:[function(t,e,o){"use strict";cc._RFpush(e,"f5284+iF/9OhImniyUWVxNI","game"),cc.Class({"extends":cc.Component,properties:{rowCount:0,colCount:0,layGame:{"default":null,type:cc.Node},patterns:{"default":[],type:[cc.Node],visible:!1},patternPre:{"default":null,type:cc.Prefab},curNode:{"default":null,type:cc.Node},saveNode:{"default":null,type:cc.Node},curScoreLabel:{"default":null,type:cc.Label},bestScoreLabel:{"default":null,type:cc.Label},gameOverNode:{"default":null,type:cc.Node},curScore:{"default":0,visible:!1,notify:function(t){t!==this.curScore&&(this.curScoreLabel.string=this.curScore)}},hasCount:{"default":0,visible:!1,notify:function(t){t!==this.hasCount&&(console.log("已经有数字的格子数 "+this.hasCount),this.hasCount===this.rowCount*this.colCount&&this.gameOver())}}},initGameLayout:function(){this.patterns=[];for(var t=(this.layGame.getContentSize(),0);t<this.rowCount;t++)for(var e=0;e<this.colCount;e++)this.createPatternAtIndex(t*this.colCount+e)},createPatternAtIndex:function(t){var e=cc.instantiate(this.patternPre);e.setPosition(this.getPosByIndex(t)),e.getComponent("pattern").init(0),this.patterns[t]=e,this.layGame.addChild(e)},createNewPattern:function(){var t,e=this,o=cc.instantiate(e.patternPre),n=o.getComponent("pattern"),i=Math.floor(cc.rand()%1e3);t=600>i?1:950>i?3:9,n.init(t,this),e.curNode.addChild(o)},movePattern:function(t){var e=t.getPosition(),o=t.getParent().convertToWorldSpaceAR(e),n=this.layGame.convertToNodeSpaceAR(o),i=this.getIndexByPos(n);if(null!==i){var c=this.patterns[i],s=c.getComponent("pattern").level;if(s>0)return void t.setPosition(cc.p(0,0));t.getComponent("pattern").offAllTouchEvent(),t.removeFromParent(),this.layGame.addChild(t),t.setPosition(this.getPosByIndex(i)),this.patterns[i].removeFromParent(),this.patterns[i]=t,this.createNewPattern(),this.mergeLogic(i)||(this.curScore+=t.getComponent("pattern").level),this.hasCount+=1}else t.setPosition(cc.p(0,0))},getSameLevelIndex:function(t,e){function o(t){var o=r.patterns[t],n=o.getComponent("pattern").level;return n===s&&-1===e.indexOf(t)?(e.push(t),!0):!1}var n=Math.floor(t/this.colCount),i=t-n*this.colCount,c=this.patterns[t],s=c.getComponent("pattern").level,r=this;if(n+1<this.rowCount){var a=t+this.colCount;o(a)&&this.getSameLevelIndex(a,e)}if(i+1<this.colCount){var a=t+1;o(a)&&this.getSameLevelIndex(a,e)}if(n-1>=0){var a=t-this.colCount;o(a)&&this.getSameLevelIndex(a,e)}if(i-1>=0){var a=t-1;o(a)&&this.getSameLevelIndex(a,e)}},mergeLogic:function(t){var e=[t];this.getSameLevelIndex(t,e),console.log("等级相同的格子indexes "+e);var o=this.patterns[t],n=o.getComponent("pattern").level;if(e.length<3)return!1;var i=o.getPosition();o.getComponent("pattern").level=n*e.length,this.curScore+=n*e.length,this.hasCount-=e.length-1;for(var c=e.length-1;c>=0;c--){var s=e[c];if(s!==t){var r=this.patterns[s];r.runAction(cc.sequence(cc.moveTo(.2,i),cc.removeSelf())),this.createPatternAtIndex(s)}}return this.mergeLogic(t),!0},getPosByIndex:function(t){var e=Math.floor(t/this.colCount),o=t-e*this.colCount,n=this.gameSize,i=-n.width/2+(o+.5)*n.width/this.colCount,c=-n.height/2+(e+.5)*n.height/this.rowCount;return cc.p(i,c)},getIndexByPos:function(t){var e=this.gameSize.width,o=this.gameSize.height,n=(t.x-this.posStart.x)/(e/this.colCount),i=(t.y-this.posStart.y)/(o/this.rowCount);return n=Math.floor(n+.5),i=Math.floor(i+.5),0>i||i>this.rowCount-1||0>n||n>this.colCount-1?null:i*this.colCount+n},isGameOver:function(){return this.hasCount===this.rowCount+this.colCount},gameOver:function(){console.log("game is over"),this.gameOverNode.active=!0,this.curScore>cc.sys.localStorage.getItem("bestScore")&&cc.sys.localStorage.setItem("bestScore",this.curScore)},replay:function(){cc.director.loadScene("game")},onLoad:function(){this.gameSize=this.layGame.getContentSize();var t=this.gameSize.width,e=this.gameSize.height;this.posStart=cc.p(-t/2+.5*t/this.colCount,-e/2+.5*e/this.rowCount),this.hasCount=0,this.initGameLayout(),this.createNewPattern(),cc.sys.localStorage.getItem("bestScore")&&""!==cc.sys.localStorage.getItem("bestScore")||cc.sys.localStorage.setItem("bestScore",0),this.bestScoreLabel.string=cc.sys.localStorage.getItem("bestScore")}}),cc._RFpop()},{}],pattern:[function(t,e,o){"use strict";cc._RFpush(e,"32e0ftbsJxGUKjCQllLr5l8","pattern");var n=[new cc.Color(75,75,75),new cc.Color(0,98,12),new cc.Color(0,61,199),new cc.Color(161,21,182),new cc.Color(254,74,0),new cc.Color(179,6,6),new cc.Color(179,6,6)];[cc.Color(200,200,200,255)];cc.Class({"extends":cc.Component,properties:{level:{"default":0,notify:function(t){t!==this.level&&this.updateUI()}},labelNum:{"default":null,type:cc.Label}},init:function(t,e){this.level=t,e&&(this.game=e,this.onTouchEvent())},updateUI:function(){if(this.node.activeInHierarchy)if(this.level>0){if(console.log("这次生成的方块等级为--"+this.level),this.node.color=new cc.Color(237,224,200),this.labelNum.string=this.level.toString(),!this.labelNum.node.activeInHierarchy)return;this.level<3?this.labelNum.node.color=n[0]:this.level<9?this.labelNum.node.color=n[1]:this.level<27?this.labelNum.node.color=n[2]:this.level<81?this.labelNum.node.color=n[3]:this.level<243?this.labelNum.node.color=n[4]:this.level<729?this.labelNum.node.color=n[5]:this.labelNum.node.color=n[6]}else console.log("默认的空白方块"),this.node.color=new cc.Color(205,193,180,255),this.labelNum.string=" "},onTouchStart:function(t,e){var o=t.touch.getLocation(),n=this.getParent().convertToNodeSpaceAR(o);this.setPosition(n)},onTouchMove:function(t,e){var o=t.touch.getLocation(),n=this.getParent().convertToNodeSpaceAR(o);this.setPosition(n)},onTouchEnd:function(t,e){var o=t.touch.getLocation();this.getParent().convertToNodeSpaceAR(o);this.getComponent("pattern").game.movePattern(this)},onTouchCancel:function(t,e){var o=t.touch.getLocation();this.getParent().convertToNodeSpaceAR(o);this.getComponent("pattern").game.movePattern(this)},onLoad:function(){this.labelNum.node.setContentSize(200,200),this.updateUI()},start:function(){this.updateUI()},onTouchEvent:function(){this.node.on("touchstart",this.onTouchStart,this.node),this.node.on("touchmove",this.onTouchMove,this.node),this.node.on("touchend",this.onTouchEnd,this.node),this.node.on("touchcancel",this.onTouchCancel,this.node)},offAllTouchEvent:function(){this.node.off("touchstart",this.onTouchStart,this.node),this.node.off("touchmove",this.onTouchMove,this.node),this.node.off("touchend",this.onTouchEnd,this.node),this.node.off("touchcancel",this.onTouchCancel,this.node)}}),cc._RFpop()},{}],welcome:[function(t,e,o){"use strict";cc._RFpush(e,"f630cJjMZNAFrcKsvgXqKOO","welcome"),cc.Class({"extends":cc.Component,properties:{},onLoad:function(){},onBtnPlay:function(){cc.director.loadScene("game")}}),cc._RFpop()},{}]},{},["pattern","game","welcome"]);